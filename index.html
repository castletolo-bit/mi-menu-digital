<!DOCTYPE html>

<html lang="es"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>La Gusguer√≠a - Men√∫ Pro</title> <script src="https://cdn.tailwindcss.com"></script> <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet"> <style> body { font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; } .product-card { transition: all 0.2s ease; } .product-card:active { transform: scale(0.97); }

    #custom-tooltip {
        position: fixed;
        display: none;
        z-index: 9999;
        background: #1e293b;
        color: #f8fafc;
        padding: 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        max-width: 220px;
        pointer-events: none;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        border: 1px solid #334155;
        line-height: 1.4;
    }

    .img-box { 
        position: relative; 
        width: 6.5rem; 
        height: 6.5rem; 
        flex-shrink: 0; 
        border-radius: 1.5rem;
        background: #f1f5f9;
        cursor: help;
    }

    @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    .animate-pop { animation: bounce 0.3s ease-out; }
</style>
</head> <body class="bg-slate-50 pb-40">

<div id="custom-tooltip"></div>

<header class="bg-gradient-to-r from-orange-600 to-red-600 text-white p-10 text-center shadow-xl rounded-b-[3.5rem] sticky top-0 z-40">
    <h1 class="text-4xl font-black uppercase tracking-tighter italic">La Gusguer√≠a</h1>
    <p class="text-[10px] font-bold tracking-[0.3em] opacity-90 mt-2 uppercase">Para apagar la sed de la mala</p>
</header>

<main id="menu-container" class="p-4 max-w-md mx-auto space-y-4 mt-4">
    <div id="loading-state" class="text-center py-20 text-slate-400 font-bold italic animate-pulse">
        Preparando el antojo...
    </div>
</main>

<footer class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md p-6 shadow-[0_-10px_30px_rgba(0,0,0,0.05)] border-t flex justify-between items-center z-50 rounded-t-[2.5rem] max-w-2xl mx-auto">
    <div class="flex flex-col">
        <span class="text-slate-400 text-[10px] uppercase font-black tracking-widest">Tu Total</span>
        <span id="total-display" class="text-3xl font-black text-slate-900 tracking-tighter">$0.00</span>
    </div>
    <button onclick="enviarWhatsApp()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-2xl font-black uppercase text-xs shadow-lg active:scale-95 transition-all">
        Pedir WhatsApp
    </button>
</footer>

<script>
    const CSV_URL = '[https://docs.google.com/spreadsheets/d/e/2PACX-1vT1TiLuDQq5Dk3vJjhmd534zHWNeHu4v-UAnDcfZxMpFaTNAzn-hy5Wmn8O1IqYvNUiMF7qbGfGLSBR/pub?gid=1374506693&single=true&output=csv](https://docs.google.com/spreadsheets/d/e/2PACX-1vT1TiLuDQq5Dk3vJjhmd534zHWNeHu4v-UAnDcfZxMpFaTNAzn-hy5Wmn8O1IqYvNUiMF7qbGfGLSBR/pub?gid=1374506693&single=true&output=csv)';
    const HASH_TEL = "NTIxNTYzOTQ3NTQ3OA=="; 

    let carrito = [];
    let total = 0;
    const tooltip = document.getElementById('custom-tooltip');

    async function cargarMenu() {
        try {
            const res = await fetch(CSV_URL + '&cache=' + Date.now());
            if (!res.ok) throw new Error("No se pudo obtener el CSV");
            
            const csvText = await res.text();
            // Limpieza de l√≠neas vac√≠as
            const filas = csvText.split(/\r?\n/).filter(line => line.trim() !== "").slice(1);
            const container = document.getElementById('menu-container');
            container.innerHTML = "";

            filas.forEach((f, index) => {
                // Regex robusto para CSV con comas dentro de comillas
                const c = f.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(x => x.replace(/^"|"$/g, '').trim());
                
                // Estructura: 0:ID, 1:Categoria, 2:Nombre, 3:Desc_ES, 4:Precio, 5:Estado, 6:ImagenURL, 7:Etiqueta, 8:Tooltip
                if (c.length < 5) return;

                const nombre = c[2] || "Producto sin nombre";
                const desc = c[3] || "";
                const precio = parseFloat(c[4]) || 0;
                const estado = (c[5] || "").toLowerCase();
                const imgUrl = c[6] || "";
                const tooltipText = c[8] || "¬°Te va a encantar!";
                const isAgotado = estado === 'agotado';

                const foto = imgUrl !== "" ? imgUrl : "[https://via.placeholder.com/300x300?text=La+Gusgueria](https://via.placeholder.com/300x300?text=La+Gusgueria)";

                container.innerHTML += `
                    <div class="product-card p-3 rounded-[2rem] bg-white border border-slate-100 flex gap-4 shadow-sm ${isAgotado ? 'opacity-50 grayscale' : ''}">
                        <div class="img-box" 
                             onmousemove="moveTooltip(event, '${tooltipText.replace(/'/g, "\\'")}')" 
                             onmouseleave="hideTooltip()">
                            <img src="${foto}" class="w-full h-full object-cover rounded-[1.5rem]" onerror="this.src='[https://via.placeholder.com/300x300?text=Antojo](https://via.placeholder.com/300x300?text=Antojo)'">
                        </div>
                        <div class="flex-1 flex flex-col justify-between py-1">
                            <div>
                                <span class="text-[8px] font-black uppercase text-orange-600 tracking-widest">${c[1] || 'General'}</span>
                                <h3 class="font-bold text-slate-800 text-sm leading-tight">${nombre}</h3>
                                <p class="text-slate-400 text-[9px] line-clamp-2 mt-1 leading-relaxed">${desc}</p>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-black text-slate-900">$${precio.toFixed(2)}</span>
                                ${isAgotado ? 
                                    '<span class="text-[9px] font-black text-red-500 uppercase">Agotado</span>' : 
                                    `<button onclick="add('${nombre.replace(/'/g,"")}', ${precio})" class="bg-orange-100 text-orange-600 w-11 h-11 rounded-2xl font-black text-xl hover:bg-orange-600 hover:text-white transition-all">+</button>`
                                }
                            </div>
                        </div>
                    </div>`;
            });

            if(container.innerHTML === "") {
                container.innerHTML = "<p class='text-center py-20 text-slate-400'>No hay productos disponibles por ahora.</p>";
            }
        } catch (e) {
            console.error(e);
            document.getElementById('menu-container').innerHTML = "<div class='text-center py-20 text-red-500 font-bold'>Error de conexi√≥n. Revisa tu internet o el archivo CSV.</div>";
        }
    }

    // TOOLTIP SMART POSITIONING
    function moveTooltip(e, text) {
        tooltip.innerText = text;
        tooltip.style.display = 'block';

        let x = e.clientX + 15;
        let y = e.clientY + 15;

        const tw = tooltip.offsetWidth;
        const th = tooltip.offsetHeight;
        const ww = window.innerWidth;
        const wh = window.innerHeight;

        // Ajuste horizontal (Derecha)
        if (x + tw > ww) x = e.clientX - tw - 15;
        // Ajuste vertical (Abajo)
        if (y + th > wh) y = e.clientY - th - 15;
        
        // Ajuste Tope/Base
        if (y < 0) y = 10;
        if (x < 0) x = 10;

        tooltip.style.left = x + 'px';
        tooltip.style.top = y + 'px';
    }

    function hideTooltip() { tooltip.style.display = 'none'; }

    function add(n, p) {
        carrito.push({ n, p });
        total += p;
        const ui = document.getElementById('total-display');
        ui.innerText = '$' + total.toFixed(2);
        ui.classList.remove('animate-pop');
        void ui.offsetWidth;
        ui.classList.add('animate-pop');
        if (navigator.vibrate) navigator.vibrate(40);
    }

    function enviarWhatsApp() {
        if (carrito.length === 0) return alert("¬°Agrega algo rico al carrito!");
        const folio = Math.floor(Math.random() * 9000) + 1000;
        let m = `*üìù NUEVO PEDIDO #${folio} - LA GUSGUER√çA*\n`;
        m += `--------------------------------\n`;
        carrito.forEach(i => m += `‚ñ™Ô∏è ${i.n} .. $${i.p.toFixed(2)}\n`);
        m += `--------------------------------\n`;
        m += `*üí∞ TOTAL: $${total.toFixed(2)}*\n\n`;
        m += `üìç _¬°Apaguen mi sed de la mala!_`;
        window.open(`https://wa.me/${atob(HASH_TEL)}?text=${encodeURIComponent(m)}`, "_top");
    }

    cargarMenu();
</script>
</body> </html>
