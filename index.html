<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Gusguer칤a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .product-card { transition: transform 0.2s; }
        .product-card:active { transform: scale(0.98); }
        /* Animaci칩n suave para el bot칩n */
        .btn-add { transition: all 0.2s; }
    </style>
</head>
<body class="bg-gray-50 pb-32">

    <header class="bg-gradient-to-br from-orange-600 to-red-600 text-white p-6 text-center shadow-lg rounded-b-3xl">
        <h1 class="text-3xl font-extrabold tracking-tight">La Gusguer칤a</h1>
        <p class="text-sm opacity-90 mt-1">춰Pide r치pido antes de que se acaben!</p>
    </header>

    <main id="menu-container" class="p-4 max-w-md mx-auto space-y-4 mt-2">
        <div class="text-center py-10">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"></div>
            <p class="text-gray-400 mt-4 text-sm">Cargando el men칰...</p>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-5px_20px_rgba(0,0,0,0.1)] border-t border-gray-100 flex justify-between items-center z-50">
        <div class="flex flex-col">
            <span class="text-gray-400 text-[10px] uppercase font-bold tracking-widest">Total Estimado</span>
            <span id="total-display" class="text-2xl font-black text-gray-800">$0.00</span>
        </div>
        <button onclick="enviarWhatsApp()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-green-200 flex items-center gap-2 transform active:scale-95 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
            </svg>
            Pedir por WhatsApp
        </button>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI칍N DEL SISTEMA
        // ==========================================
        
        // 1. Enlace CSV de Google Sheets (Publicado en la Web)
        // const SHEET_CSV_URL = 'TU_LINK_DE_GOOGLE_SHEETS_AQUI'; 
        // const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBENNz-awzr5fmMUjdlGUBHr1EYFlGGXtDEKRuOQT_iXmU8f9zf4z2OMG9TLiQBO2KLHRLpgoqti0z/pub?output=csv'; 
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT1TiLuDQq5Dk3vJjhmd534zHWNeHu4v-UAnDcfZxMpFaTNAzn-hy5Wmn8O1IqYvNUiMF7qbGfGLSBR/pubhtml?gid=1374506693&single=true'; 
        
        // 2. N칰mero de WhatsApp del negocio (Solo n칰meros, sin signos)
        // const TELEFONO_NEGOCIO = '521XXXXXXXXXX'; 
       const TELEFONO_NEGOCIO = '5215639475478'; // N칰mero sin s칤mbolos (+), solo n칰meros.
 
        // ==========================================
        // L칍GICA DEL SISTEMA
        // ==========================================
        let carrito = [];
        let total = 0;

        async function cargarMenu() {
            try {
                // Truco t칠cnico: A침adimos un "cachebuster" para que siempre baje los datos frescos
                const response = await fetch(SHEET_CSV_URL + '&cache=' + new Date().getTime());
                const data = await response.text();
                
                // Procesamiento de CSV (separando por saltos de l칤nea)
                const filas = data.split('\n').slice(1); 
                
                const container = document.getElementById('menu-container');
                container.innerHTML = ""; // Limpiamos el cargador

                filas.forEach(fila => {
                    // Limpieza de datos (Quitar comillas extra침as de Excel/Sheets)
                    const columnas = fila.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if(columnas.length < 5) return; // Si la fila est치 incompleta, la ignoramos

                    // Mapeo de columnas: 0:ID, 1:Categoria, 2:Nombre, 3:Desc, 4:Precio, 5:Estado
                    const [id, cat, nombre, desc, precioRaw, estadoRaw] = columnas.map(c => c.replace(/"/g, '').trim());
                    
                    // Detectar si est치 agotado
                    const isAgotado = estadoRaw && estadoRaw.toLowerCase() === 'agotado';
                    const precio = parseFloat(precioRaw) || 0;

                    // L칍GICA VISUAL: AGOTADO VS DISPONIBLE
                    let botonHtml = '';
                    let descripcionHtml = '';
                    let opacidadClase = '';

                    if (isAgotado) {
                        // Caso: AGOTADO
                        opacidadClase = 'opacity-60 grayscale'; // Se ve gris
                        descripcionHtml = `<span class="text-red-600 font-black tracking-widest text-sm bg-red-50 px-2 py-1 rounded">AGOTADO</span>`;
                        botonHtml = `
                            <button disabled class="bg-gray-200 text-gray-400 w-12 h-12 rounded-xl font-bold text-xl cursor-not-allowed">
                                x
                            </button>
                        `;
                    } else {
                        // Caso: DISPONIBLE
                        opacidadClase = 'bg-white';
                        descripcionHtml = `<p class="text-gray-500 text-xs leading-tight">${desc}</p>`;
                        botonHtml = `
                            <button onclick="agregar('${nombre}', ${precio})" class="btn-add bg-orange-100 text-orange-600 w-12 h-12 rounded-xl font-bold text-2xl shadow-sm hover:bg-orange-500 hover:text-white border border-orange-200">
                                +
                            </button>
                        `;
                    }

                    // Renderizado de la Tarjeta
                    const card = `
                        <div class="product-card p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center ${opacidadClase} mb-3 bg-white">
                            <div class="flex-1 pr-4">
                                <span class="text-[10px] uppercase font-bold text-orange-400 tracking-wider">${cat}</span>
                                <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1">${nombre}</h3>
                                ${descripcionHtml}
                                <p class="text-gray-900 font-black mt-2 text-lg">$${precio}</p>
                            </div>
                            <div>
                                ${botonHtml}
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (e) {
                console.error(e);
                document.getElementById('menu-container').innerHTML = 
                    "<div class='p-4 bg-red-100 text-red-700 rounded-xl text-center'>Error de conexi칩n. Revisa el link de Google Sheets.</div>";
            }
        }

        function agregar(nombre, precio) {
            carrito.push({ nombre, precio });
            total += precio;
            actualizarTotal();
            
            // Peque침a vibraci칩n en m칩viles si lo soportan (mejora UX)
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function actualizarTotal() {
            document.getElementById('total-display').innerText = `$${total.toFixed(2)}`;
        }

        function enviarWhatsApp() {
            if (carrito.length === 0) {
                alert("游 Tu carrito est치 vac칤o. Agrega algo rico primero.");
                return;
            }

            // Generaci칩n de Folio
            const ahora = new Date();
            const folio = ahora.getHours() + "" + ahora.getMinutes() + "" + ahora.getSeconds();

            // Construcci칩n del Ticket Seguro
            let texto = `*游닇 PEDIDO #${folio}*\n`;
            texto += `_Fecha: ${ahora.toLocaleDateString()}_\n`;
            texto += `--------------------------------\n`;
            
            carrito.forEach(item => {
                texto += `郊쀮잺 ${item.nombre} .. $${item.precio}\n`;
            });
            
            texto += `--------------------------------\n`;
            texto += `*游눯 TOTAL: $${total.toFixed(2)}*\n\n`;
            texto += `游늸 _Confirmo mi pedido, espero instrucciones._`;

            // Codificaci칩n para URL (Evita errores de corte de mensaje)
            const mensajeFinal = encodeURIComponent(texto);
            const url = `https://wa.me/${TELEFONO_NEGOCIO}?text=${mensajeFinal}`;
            
            // Forzar apertura en la misma ventana (mejor para Android/iOS)
            window.open(url, '_top');
        }

        // Iniciar
        cargarMenu();
    </script>
</body>
</html>
