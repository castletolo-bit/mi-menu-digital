<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men√∫ Digital - Pedido Seguro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .product-card { transition: transform 0.2s; }
        .product-card:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-gray-50 pb-32">

    <header class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 text-center shadow-lg">
        <h1 class="text-3xl font-extrabold italic">Nuestro Men√∫</h1>
        <p class="text-sm opacity-90">Viernes, S√°bados y Domingos</p>
    </header>

    <main id="menu-container" class="p-4 max-w-md mx-auto space-y-4">
        <p class="text-center text-gray-500 animate-pulse">Cargando delicias...</p>
    </main>

    <div class="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-5px_15px_rgba(0,0,0,0.1)] border-t flex justify-between items-center z-50">
        <div>
            <p class="text-gray-400 text-xs uppercase font-bold tracking-widest">Total</p>
            <p id="total-display" class="text-2xl font-black text-orange-600">$0.00</p>
        </div>
        <button onclick="enviarWhatsApp()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-2xl font-bold shadow-lg flex items-center gap-2 transition-all">
            <span>Pedir por WhatsApp</span>
        </button>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN (RELLENA ESTOS DATOS)
        // ==========================================
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQBENNz-awzr5fmMUjdlGUBHr1EYFlGGXtDEKRuOQT_iXmU8f9zf4z2OMG9TLiQBO2KLHRLpgoqti0z/pub?output=csv'; 
        const TELEFONO_NEGOCIO = '5215518376723'; // N√∫mero sin s√≠mbolos (+), solo n√∫meros.

        let carrito = [];
        let total = 0;

        // Funci√≥n para cargar los datos desde Google Sheets
        async function cargarMenu() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                const data = await response.text();
                const filas = data.split('\n').slice(1); 
                
                const container = document.getElementById('menu-container');
                container.innerHTML = ""; // Limpiar mensaje de carga

                filas.forEach(fila => {
                    // Limpiamos la fila de caracteres raros
                    const columnas = fila.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if(columnas.length < 5) return;

                    const [id, cat, nombre, desc, precio, estado] = columnas.map(c => c.replace(/"/g, '').trim());
                    
                    if(estado.toLowerCase() === 'agotado') return;

                    const card = `
                        <div class="product-card bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center">
                            <div class="flex-1 pr-4">
                                <span class="text-[10px] uppercase font-bold text-orange-400">${cat}</span>
                                <h3 class="font-bold text-gray-800 text-lg">${nombre}</h3>
                                <p class="text-gray-500 text-xs leading-tight">${desc}</p>
                                <p class="text-gray-900 font-black mt-2 text-md">$${precio}</p>
                            </div>
                            <button onclick="agregar('${nombre}', ${precio})" class="bg-orange-500 text-white w-12 h-12 rounded-xl font-bold text-xl shadow-md active:bg-orange-700">
                                +
                            </button>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (e) {
                document.getElementById('menu-container').innerHTML = "<p class='text-red-500 text-center'>Error al conectar con el men√∫. Verifica el link de Sheets.</p>";
            }
        }

        function agregar(nombre, precio) {
            carrito.push({ nombre, precio });
            total += parseFloat(precio);
            document.getElementById('total-display').innerText = `$${total.toFixed(2)}`;
            
            // Efecto sutil para confirmar que se agreg√≥
            console.log("Agregado: " + nombre);
        }

function enviarWhatsApp() {
    if (carrito.length === 0) {
        alert("¬°Tu carrito est√° vac√≠o! Selecciona algunos productos primero.");
        return;
    }

    // 1. Generar Folio y Fecha
    const ahora = new Date();
    const folio = ahora.getHours().toString().padStart(2, '0') + 
                  ahora.getMinutes().toString().padStart(2, '0') + 
                  ahora.getSeconds().toString().padStart(2, '0');

    // 2. Construir el texto del Ticket de forma limpia
    let textoTicket = `*üì¶ NUEVO PEDIDO #ID-${folio}*\n`;
    textoTicket += `_Fecha: ${ahora.toLocaleDateString()}_\n`;
    textoTicket += `------------------------------\n`;
    
    carrito.forEach(item => {
        textoTicket += `‚úÖ ${item.nombre} - $${item.precio}\n`;
    });
    
    textoTicket += `------------------------------\n`;
    textoTicket += `*TOTAL A PAGAR: $${total.toFixed(2)}*\n\n`;
    textoTicket += `üìç _Por favor, conf√≠rmenme para enviar mi ubicaci√≥n._`;

    // 3. LA CLAVE: Codificar el texto para que WhatsApp lo lea completo
    const mensajeCodificado = encodeURIComponent(textoTicket);

    // 4. Construir URL Final
    const urlFinal = `https://wa.me/${TELEFONO_NEGOCIO}?text=${mensajeCodificado}`;

    // 5. Ejecutar env√≠o (usamos _top para asegurar que abra en el celular)
    window.open(urlFinal, '_top');
}

        // Ejecutar carga al abrir la p√°gina
        cargarMenu();
    </script>
</body>
</html>
